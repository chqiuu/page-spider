# 页面爬虫浏览器扩展

浏览器扩展部分，负责在网页中执行爬取任务。

## 功能特性

- ✅ 浏览器扩展方式运行，使用真实浏览器环境
- ✅ 支持基于URL的自动规则匹配
- ✅ 支持自定义CSS选择器
- ✅ 本地IndexedDB数据库存储（默认）
- ✅ MySQL数据库支持（需要配合服务端）
- ✅ 可配置爬取延迟时间
- ✅ 数据查看、导出、清空功能

## 项目结构

```
extension/
├── manifest.json          # 扩展配置文件
├── popup.html             # 扩展弹窗界面
├── popup.css              # 弹窗样式
├── popup.js               # 弹窗逻辑
├── content.js             # 内容脚本（在网页中运行）
├── background.js          # 后台服务脚本
├── crawler-engine.js      # 爬虫引擎（规则匹配和执行）
├── icons/                 # 扩展图标
│   ├── icon16.png
│   ├── icon48.png
│   └── icon128.png
├── package.json           # 项目配置
└── README.md             # 说明文档
```

## 安装步骤

### 1. 加载扩展到Edge浏览器

1. 打开Edge浏览器
2. 在地址栏输入 `edge://extensions/` 并回车
3. 开启"开发人员模式"（右上角开关）
4. 点击"加载解压缩的扩展"
5. 选择 `extension` 文件夹

### 2. 配置服务端（可选，使用MySQL时）

如果使用MySQL数据库，需要：

1. 启动服务端服务器（见 `../server/README.md`）
2. 在扩展弹窗中配置数据库连接信息

## 使用方法

### 基本使用

1. **打开目标网页**：在浏览器中打开需要爬取的网页

2. **配置爬取参数**：
   - 选择爬取模式（自动匹配规则 或 自定义选择器）
   - 设置延迟时间（毫秒）

3. **开始爬取**：
   - 点击"开始爬取"按钮
   - 扩展会自动按照配置进行爬取

4. **查看数据**：
   - 点击"查看数据"在新窗口查看所有爬取的数据
   - 点击"导出数据"将数据导出为JSON文件
   - 点击"清空数据"删除所有存储的数据

### 配置MySQL数据库（可选）

1. **启动服务端**：
   ```bash
   cd ../server
   npm install
   npm start
   ```

2. **在扩展中配置数据库**：
   - 打开扩展弹窗
   - 在"数据库配置"区域填写数据库信息
   - 点击"测试连接"验证配置
   - 点击"保存配置"
   - 勾选"使用MySQL数据库"

## 技术栈

- **Manifest V3**：使用最新的扩展API
- **IndexedDB**：本地数据库存储（浏览器内置）
- **Content Scripts**：在网页中执行爬取逻辑
- **Service Worker**：后台服务处理数据存储

## 开发说明

### 添加新规则

在 `crawler-engine.js` 中的 `RULES` 对象中添加新规则，参考 `RULES.md` 文档。

### 数据存储

- **IndexedDB（默认）**：数据存储在浏览器本地
- **MySQL（可选）**：通过HTTP API与本地服务器通信

## 注意事项

1. 首次使用需要手动创建图标文件（或使用默认图标）
2. 确保目标网站允许扩展访问（在manifest.json中已配置`<all_urls>`权限）
3. 爬取大量数据时注意浏览器性能
4. 使用MySQL时必须启动服务端服务器

## 许可证

MIT License

